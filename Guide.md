# 使用指南

## 准备记录参数

由于闹钟的参数比较多，建议打开一个文本编辑器来记录参数

运行闹钟的子命令为 `run`，因此请在文本编辑器中输入 `run`

此时你的编辑器里应该是：
```pwsh
run
```

## 准备播放列表

你需要一份 UTF-8 文本文档，每行一个文件路径，像这样：

```
C:\Users\Administrator\Music\1.mp3
C:\Users\Administrator\Music\2.mp3
C:\Users\Administrator\Music\3.mp3
```

必须使用绝对路径

`#` 开头的行会被忽略，因此闹钟会忽略 M3U8 注释与标签

Windows 自带的媒体播放器创建的列表是符合要求的，这些文件通常在 `%USERPROFILE%\Music\Playlist\`

将播放列表文件的绝对路径添加到命令末尾

此时你的编辑器里应该像是：
```
run C:\path\of\playlist.txt
```

到这里为止，必要的参数已经填写完成，下面的是可选的参数与选项

## 选定播放设备

为了防止你晚上忘记拔耳机，一般建议指定扬声器作为闹钟的输出设备

当然，你也可以选择使用系统默认的输出设备

使用 `Alarm show devices` 查看所有的音频设备，并记下要用的设备的 GUID，然后添加到命令末尾

如果要使用默认音频设备，则忽略这个参数

此时你的编辑器里应该像是：
```
run C:\path\of\playlist.txt 00000000-0000-0000-0000-000000000000
```

到这里为止，基本参数已经填写完成，下面是高级选项

## 启用 PB

PB 模块用于减少你在相隔不久的时间里听到相同的音乐的可能性

要启用此功能，请在命令末尾添加 `-pb pb.json`

其中，`pb.json` 是 PB 数据文件的路径（相对于可执行文件的位置），可以更改

此时你的编辑器里应该像是：
```
run C:\path\of\playlist.txt 00000000-0000-0000-0000-000000000000 -pb pb.json
```

## 启用 PL

当你有整理音乐目录的习惯时，PL 模块可以减少你连续听到相似音乐的可能性

要启用此功能，请在命令末尾添加 `-pl`

此时你的编辑器里应该像是：
```
run C:\path\of\playlist.txt 00000000-0000-0000-0000-000000000000 -pb pb.json -pl
```

## 启用历史记录

要启用此功能，请在命令末尾添加 `-log history.log`

其中，`history.log` 是历史记录文件的路径（相对于可执行文件的位置），可以更改

此时你的编辑器里应该像是：
```
run C:\path\of\playlist.txt 00000000-0000-0000-0000-000000000000 -pb pb.json -pl -log history.log
```

## 启用 HTTP 控制

通常，家用 PC 没有远程控制闹钟的需求，这个功能实际上是为 Windows 任务计划程序设计的

> 如果任务计划程序不管用户是否登录都运行程序，则程序会运行在 winlogon 桌面上，用户无法看到并控制

要启用此功能，请在命令末尾添加 `-pfx http://127.0.0.1:22120/`

其中，`http://127.0.0.1:22120/` 是 HTTP 侦听前缀，`127.0.0.1` 是回环 IP 地址，`22120` 是端口号。你也可以改成想要的前缀，注意要以 `/` 结尾

可以添加多个 HTTP 侦听前缀，传递多个 `-pfx` 参数即可

此时你的编辑器里应该像是：
```
run C:\path\of\playlist.txt 00000000-0000-0000-0000-000000000000 -pb pb.json -pl -log history.log -pfx http://127.0.0.1:22120/
```

## 调整音量

调整音量功能会附带取消静音，静音状态也会在程序正常退出后恢复

要启用此功能，请在命令末尾添加 `-sv 50`

其中，`50` 是设定的音量，可以修改，取值范围为 [0, 100] 之间的整数

此时你的编辑器里应该像是：
```
run C:\path\of\playlist.txt 00000000-0000-0000-0000-000000000000 -pb pb.json -pl -log history.log -pfx http://127.0.0.1:22120/ -sv 50
```

## 启动闹钟

到此，所有的参数已经填写完成，将文本编辑器里的内容作为参数启动闹钟，就可以使闹钟运行

在闹钟的控制台窗口内按 Ctrl+C 可以正常退出程序，按 Ctrl+N 可以切换到下一首音乐

## 启动远程控制

如果闹钟没有使用 HTTP 控制功能，则不需要这个

在闹钟正在运行时，使用以下参数启动闹钟，可以启动远程控制程序：
```
rc http://127.0.0.1:22120/
```

`http://127.0.0.1:22120/` 是之前设定的 HTTP 控制 URL，按照实际情况修改

在控制台窗口内按 Ctrl+C 可以正常退出程序，按 Ctrl+N 可以切换到下一首音乐

当然，也可以用 curl 等程序进行控制：
```bash
# 获取状态
curl -X GET http://127.0.0.1:22120/
# 切换到下一首
curl -X GET http://127.0.0.1:22120/
# 停止
curl -X GET http://127.0.0.1:22120/
```

## 使用任务计划程序启动闹钟

由于闹钟本身不会定时启动，因此我们需要用其他方式定时启动

在 Windows 上，推荐使用任务计划程序，此时刚才的文本编辑器中的内容就是程序的启动参数
